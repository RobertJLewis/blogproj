{% extends 'blog/base.html' %}

{% block content %}

<!-- Post box at the top -->
{% if user.is_authenticated %}
<div class="card mb-4">
  <div class="card-body">
    <form method="post" action="{% url 'blog-new' %}" enctype="multipart/form-data">
        {% csrf_token %}
        
        <!-- Title field -->
        <input type="text" name="title" class="form-control mb-2" placeholder="Title" required>

        <!-- Content field -->
        <textarea name="content" class="form-control mb-2" placeholder="What's on your mind?..." rows="4" required></textarea>
        
        <!-- Image upload (optional) -->
        <input type="file" name="image" accept="image/*" class="form-control mb-2">

        <!-- Submit button -->
        <button type="submit" class="btn btn-primary mt-2">Post</button>
    </form>
  </div>
</div>
{% endif %}

<!-- Display posts -->
{% for post in posts %}
<article class="media content-section position-relative mb-4 p-3 border rounded">
    <img class="rounded-circle article-img" src="{{ post.author.profile.image.url }}" alt="">
    <div class="media-body">
        <div class="article-metadata mb-2">
            <a class="mr-2" href="#">{{ post.author }}</a>
            <small class="text-muted">{{ post.date_posted }}</small>
        </div>

        <h2><a class="article-title" href="{% url 'blog-detail' post.id %}">{{ post.title }}</a></h2>
        <p class="article-content">{{ post.content }}</p>

        <!-- Image (optional) -->
        {% if post.image %}
        <div class="mb-2">
            <img src="{{ post.image.url }}" class="img-fluid rounded" style="max-height: 300px; width: auto;" alt="Post image">
        </div>
        {% endif %}

        <!-- Like/Dislike buttons -->
        <div class="d-flex justify-content-start mt-2">
          <a href="{% url 'like-post' post.id %}" class="btn btn-outline-success btn-sm mr-1">
              üëç {{ post.total_likes }}
          </a>
          <a href="{% url 'dislike-post' post.id %}" class="btn btn-outline-danger btn-sm mr-1">
              üëé {{ post.total_dislikes }}
          </a>
          <a href="{% url 'blog-detail' post.id %}#comment-form" class="btn btn-outline-primary btn-sm mr-1">
              üí¨ Comment
          </a>
      </div>

        <!-- Comment preview -->
        <div class="mt-3">
            <h6>Comments</h6>
            {% for comment in post.comments.all|slice:":2" %}
                <div class="p-2 border rounded mb-2">
                    <strong>{{ comment.author }}</strong>
                    <small class="text-muted">{{ comment.date_posted }}</small><br>
                    {{ comment.content }}
                </div>
            {% empty %}
                <p>No comments yet.</p>
            {% endfor %}

            {% if post.comments.count > 2 %}
                <a href="{% url 'blog-detail' post.id %}" class="btn btn-link btn-sm p-0">See More Comments...</a>
            {% endif %}
        </div>
    </div>
</article>
{% endfor %}

{% endblock content %}
